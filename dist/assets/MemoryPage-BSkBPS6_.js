import{r,j as e,c as I,u as Q,R as B,V as v}from"./index-DtQKTCyE.js";import{f as k,u as W,P as G}from"./ui-DEVpiA7k.js";import{F as z,p as X,M as q}from"./MemoryList-DDBsa5H4.js";import{a as u,A as f}from"./axios-DtPRMkeS.js";function U({title:t,titleId:s,...l},a){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":s},l),t?r.createElement("title",{id:s},t):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"}))}const V=r.forwardRef(U);function Y({title:t,titleId:s,...l},a){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":s},l),t?r.createElement("title",{id:s},t):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))}const $=r.forwardRef(Y);function K({title:t,titleId:s,...l},a){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":s},l),t?r.createElement("title",{id:s},t):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"}))}const Z=r.forwardRef(K);function J({title:t,titleId:s,...l},a){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":s},l),t?r.createElement("title",{id:s},t):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))}const ee=r.forwardRef(J);function te(t,s){const[l,a]=r.useState(t);return r.useEffect(()=>{const o=setTimeout(()=>{a(t)},s);return()=>{clearTimeout(o)}},[t,s]),l}const se=({onSearch:t,isLoading:s})=>{const[l,a]=r.useState(""),o=d=>{d.preventDefault(),t(l)};return e.jsx("div",{className:"p-4 border-b border-mythicGold bg-black/30 rounded-t-xl",children:e.jsxs("form",{onSubmit:o,className:"flex gap-2 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx($,{className:"h-5 w-5 text-mythicGold"})}),e.jsx("input",{type:"text",value:l,onChange:d=>a(d.target.value),placeholder:"Search memories...",className:"block w-full pl-10 pr-3 py-2 border border-mythicGold bg-black/60 text-white font-serif mythic-input placeholder:text-mythicGold placeholder:opacity-80 focus:outline-none focus:ring-2 focus:ring-mythicGold rounded-lg",disabled:s})]}),e.jsx("button",{type:"submit",disabled:s,className:"mythic-btn inline-flex items-center px-4 py-2 border border-mythicGold text-sm font-medium text-white bg-mythicGold font-serif mythic-heading focus:outline-none focus:ring-2 focus:ring-mythicGold transition-all duration-150 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg",children:s?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):"Search"})]})})},D=({memory:t,onUpdate:s,onDelete:l,isDesktop:a=!1})=>{const[o,d]=r.useState(!1),[p,m]=r.useState(t.content),[y,g]=r.useState(t.tags.join(", "));r.useEffect(()=>{m(t.content),g(t.tags.join(", "))},[t]);const b=()=>{const i={content:p,tags:y.split(",").map(h=>h.trim()).filter(Boolean)};s({...t,...i}),d(!1)},j=()=>{m(t.content),g(t.tags.join(", ")),d(!1)};return e.jsxs("div",{className:a?"h-full flex flex-col bg-black/80 border-l-4 border-mythicGold shadow-[inset_2px_0_12px_rgba(191,167,106,0.12)] rounded-r-xl text-[#f5f5f5] font-serif":"h-full flex flex-col bg-black/95 border border-mythicGold text-[#f5f5f5] font-serif rounded-t-2xl",children:[e.jsxs("div",{className:"p-4 border-b border-mythicGold flex flex-col sm:flex-row sm:items-center sm:justify-between bg-black/30 gap-2 sm:gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 text-xs font-bold border border-mythicGold uppercase tracking-widest text-mythicGold bg-black/40 rounded-md",children:["TYPE: ",t.type.toUpperCase()]}),t.archived&&e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 text-xs font-medium border border-mythicGold text-mythicGold bg-black/40 rounded-md",children:"Archived"})]}),e.jsx("div",{className:"flex flex-row flex-nowrap items-center gap-3 mt-2 sm:mt-0",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:b,className:"mythic-btn flex items-center gap-1 px-3 py-1.5 border border-mythicGold text-white bg-mythicGold mythic-heading focus:outline-none focus:ring-2 focus:ring-mythicGold whitespace-nowrap",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{children:"Save"})]}),e.jsxs("button",{onClick:j,className:"mythic-btn flex items-center gap-1 px-3 py-1.5 border border-mythicGold text-mythicGold bg-transparent mythic-heading focus:outline-none focus:ring-2 focus:ring-mythicGold whitespace-nowrap",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx("span",{children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>d(!0),className:"mythic-btn flex items-center gap-1 px-3 py-1.5 border border-mythicGold text-mythicGold bg-transparent mythic-heading focus:outline-none focus:ring-2 focus:ring-mythicGold whitespace-nowrap",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{children:"Edit"})]}),e.jsxs("button",{onClick:()=>l(t.id),className:"mythic-btn flex items-center gap-1 px-3 py-1.5 border border-mythicGold text-white bg-red-700 mythic-heading focus:outline-none focus:ring-2 focus:ring-mythicGold whitespace-nowrap",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{children:"Delete"})]})]})})]}),e.jsx("div",{className:"flex-1 p-4 overflow-y-auto",children:o?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"content",className:"block text-sm mythic-heading text-mythicGold",children:"Content"}),e.jsx("textarea",{id:"content",rows:10,value:p,onChange:i=>m(i.target.value),className:"mt-1 block w-full border border-mythicGold bg-black/30 text-[var(--ink-dark)] font-serif mythic-input focus:outline-none focus:ring-2 focus:ring-mythicGold"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-sm mythic-heading text-mythicGold",children:"Tags (comma-separated)"}),e.jsx("input",{type:"text",id:"tags",value:y,onChange:i=>g(i.target.value),className:"mt-1 block w-full border border-mythicGold bg-black/30 text-[var(--ink-dark)] font-serif mythic-input focus:outline-none focus:ring-2 focus:ring-mythicGold"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg mythic-heading text-mythicGold",children:"Content"}),e.jsx("p",{className:"mt-2 text-base text-[var(--ink-dark)] whitespace-pre-wrap mythic-body",children:t.content})]}),t.tags.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-mythicGold tracking-wide mb-1 capitalize mythic-heading",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.tags.map(i=>e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 text-xs font-medium border border-mythicGold text-mythicGold bg-black/30 rounded-md mythic-tag transition-all duration-150 hover:shadow-mythic-glow capitalize",style:{letterSpacing:"0.01em"},children:i},i))})]}),t.entities.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-mythicGold tracking-wide mb-1 capitalize mythic-heading",children:"Entities"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.entities.map((i,h)=>e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 text-xs font-medium border border-mythicGold text-mythicGold bg-black/30 rounded-md mythic-tag transition-all duration-150 hover:shadow-mythic-glow capitalize",style:{letterSpacing:"0.01em"},children:[i.text," ",e.jsxs("span",{className:"ml-1 text-[10px] text-mythicGold",children:["(",i.type,")"]})]},h))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg mythic-heading text-mythicGold",children:"Metadata"}),e.jsxs("dl",{className:"mt-2 grid grid-cols-1 gap-x-4 gap-y-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm mythic-heading text-mythicGold",children:"Created"}),e.jsx("dd",{className:"mt-1 text-base text-[var(--ink-dark)] mythic-body",children:k(new Date(t.created_at),"PPpp")})]}),t.updated_at&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm mythic-heading text-mythicGold",children:"Last Updated"}),e.jsx("dd",{className:"mt-1 text-base text-[var(--ink-dark)] mythic-body",children:k(new Date(t.updated_at),"PPpp")})]}),t.event_date&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm mythic-heading text-mythicGold",children:"Event Date"}),e.jsx("dd",{className:"mt-1 text-base text-[var(--ink-dark)] mythic-body",children:k(X(t.event_date),"yyyy-MM-dd")})]})]})]})]})})]})};function E(t){if(typeof t=="string")return t;if(t==null)return"";try{return JSON.stringify(t)}catch{return String(t)}}function w(t){return{...t,content:E(t.content),tags:Array.isArray(t.tags)?t.tags:[],entities:Array.isArray(t.entities)?t.entities:[],meta:t.meta||{},protocol_flags:Array.isArray(t.protocol_flags)?t.protocol_flags:[],created_at:t.created_at||new Date().toISOString()}}const N={async listEntries(t=0,s=20){const l=await u.get(f.CODEX,{params:{skip:t,limit:s}});return Array.isArray(l.data)?l.data.map(w):[]},async getEntry(t){const s=await u.get(f.CODEX_ENTRY(t));return w(s.data)},async createEntry(t){const s=await u.post(f.CODEX,{...t,content:E(t.content)});return w(s.data)},async updateEntry(t,s){const l=await u.put(f.CODEX_ENTRY(t),{...s,content:s.content?E(s.content):void 0});return w(l.data)},async deleteEntry(t){await u.delete(f.CODEX_ENTRY(t))},async semanticSearch(t){const s=await u.get(f.CODEX_SEARCH,{params:{query:t}});return Array.isArray(s.data)?s.data.map(w):[]}},re=I()(t=>({selectedMemory:null,setSelectedMemory:s=>t({selectedMemory:s}),clearSelectedMemory:()=>t({selectedMemory:null})})),oe=()=>{const[t,s]=r.useState(""),{selectedMemory:l,setSelectedMemory:a,clearSelectedMemory:o}=re(),[d,p]=r.useState(!1),m=te(t,300),y=Q(),g=typeof window<"u"&&window.innerWidth<768,b=r.useRef(null),j=r.useRef(0),i=r.useRef(0),[h,S]=r.useState(!1),{data:x,fetchNextPage:L,hasNextPage:R,isFetchingNextPage:C,isLoading:M,error:A}=W({queryKey:["memories",m],queryFn:async({pageParam:n=0})=>{try{if(m)return{items:await N.semanticSearch(m)||[],nextPage:null};{const c=await N.listEntries(n,G);return{items:c||[],nextPage:c.length===G?n+G:null}}}catch(c){return console.error("Error fetching memories:",c),{items:[],nextPage:null}}},initialPageParam:0,getNextPageParam:n=>n.nextPage,enabled:!d}),_=async n=>{try{await N.updateEntry(n.id,n),y.invalidateQueries({queryKey:["memories"]}),a(n),v.success("Memory updated successfully",{style:{background:"#22c55e",color:"#fff"}})}catch{v.error("Failed to update memory")}},P=async n=>{try{await N.deleteEntry(n),y.invalidateQueries({queryKey:["memories"]}),o(),v.success("Memory deleted successfully",{style:{background:"#22c55e",color:"#fff"}})}catch{v.error("Failed to delete memory")}},F=n=>{s(n),p(!0),setTimeout(()=>p(!1),500)},T=B.useMemo(()=>x!=null&&x.pages?x.pages.flatMap(n=>n.items||[]):[],[x==null?void 0:x.pages]),O=async()=>{const n=b.current;if(!n)return;const c=n.scrollHeight-n.scrollTop-n.clientHeight;S(!0),await L(),S(!1),n&&(n.scrollTop=n.scrollHeight-n.clientHeight-c)};return r.useEffect(()=>{if(!h){const n=b.current;if(n&&j.current){const H=n.scrollHeight-j.current;n.scrollTop=i.current+H}}},[x,h]),e.jsx("div",{className:"flex-1 flex flex-col min-h-0 h-full w-full",children:e.jsx("div",{className:"flex-1 flex flex-col h-full min-h-0 max-w-5xl w-full mx-auto",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 h-full min-h-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col h-full min-h-0",children:[e.jsx("div",{className:"mb-4 flex-shrink-0",children:e.jsx(se,{onSearch:F,isLoading:M})}),e.jsx("div",{className:"flex-1 flex flex-col min-h-0",children:e.jsx("div",{className:"flex-1 overflow-y-auto pr-2 bg-white min-h-0",ref:b,children:e.jsxs("div",{className:"w-full max-w-5xl mx-auto px-4 py-6 relative",children:[e.jsx(q,{memories:T,selectedMemoryId:l==null?void 0:l.id,onSelect:a,isLoading:M,error:A}),R&&!m&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx("button",{onClick:O,className:"px-4 py-2 rounded-full border border-mythicGold text-mythicGold bg-black/40 text-sm font-medium shadow mythic-btn hover:bg-mythicGold/10 hover:text-white hover:shadow-mythic-glow focus:shadow-mythic-glow transition flex items-center gap-2 disabled:opacity-60 disabled:cursor-not-allowed",disabled:h||C,style:{minWidth:110},children:h||C?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"animate-spin h-4 w-4 border-b-2 border-mythicGold rounded-full inline-block"})," Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 mr-1 text-mythicGold",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})}),"Load More"]})})})]})})})]}),e.jsx("div",{className:"w-full md:w-[380px] flex-shrink-0",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-end md:hidden",style:{display:g?"flex":"none"},onClick:()=>o(),children:[e.jsx("button",{className:"absolute top-2 right-2 z-60 text-gray-400 hover:text-gray-700 text-3xl font-bold bg-white rounded-full shadow p-0.5",style:{lineHeight:"1",width:"2.5rem",height:"2.5rem"},onClick:()=>o(),"aria-label":"Close",children:"Ã—"}),e.jsx("div",{className:"w-full bg-black/95 rounded-t-2xl shadow-none max-h-[90vh] overflow-y-auto relative pt-12 border-t-4 border-mythicGold",onClick:n=>n.stopPropagation(),children:e.jsx(D,{memory:l,onUpdate:_,onDelete:P,isDesktop:!1})})]}),e.jsx("div",{className:"hidden md:block h-full",children:e.jsx("div",{className:"h-full bg-black/80 border-l-4 border-mythicGold shadow-[inset_2px_0_12px_rgba(191,167,106,0.12)] rounded-r-xl",children:e.jsx(D,{memory:l,onUpdate:_,onDelete:P,isDesktop:!0})})})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:"Select a memory to view details"})})]})})})};export{oe as MemoryPage};
